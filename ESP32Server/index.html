<!DOCTYPE html>
<html>
  <head>
    <title>ESP32 Control Panel</title>
  </head>
  <body onload="updateData()">
    <h1>ESP32 Control Panel</h1>

    <!-- <h2>Điều khiển Đèn</h2>
    <button onclick="turnOn()">Bật Đèn</button>
    <button onclick="turnOff()">Tắt Đèn</button> -->

    <h2>Thông tin cảm biến quang tương tự</h2>
    <p id="light"></p>
    <p id="humidity"></p>

    <h2>Thông tin cảm biến dò line</h2>
    <p id="line"></p>

    <h2>Thông tin cảm biến siêu âm</h2>
    <p id="distance"></p>

    <h2>Thông tin cảm biến khí ga</h2>
    <p id="gas"></p>

    <h2>Điều khiển Servo</h2>
    <input type="number" id="servoAngle" placeholder="Nhập góc (0-90)" />
    <button onclick="controlServo()">Điều khiển Servo</button>

    <h2>Điều khiển DC</h2>
    <button onclick="controlDC()">Đổi chiều</button>

    <script>
      var espServer = 'http://192.168.4.1'
      var dc = 0
      function turnOn() {
        fetch(espServer + '/led=on')
          .then((response) => {
            if (!response.ok) {
              throw new Error('Network response was not ok')
            }
            console.log('LED turned on')
          })
          .catch((error) => console.error('Error:', error))
      }

      function turnOff() {
        fetch(espServer + '/led=off')
          .then((response) => {
            if (!response.ok) {
              throw new Error('Network response was not ok')
            }
            console.log('LED turned off')
          })
          .catch((error) => console.error('Error:', error))
      }

      function getTemperature() {
        fetch(espServer + '/dht/temp')
          .then((response) => {
            if (!response.ok) {
              throw new Error('Network response was not ok')
            }
            return response.text()
          })
          .then((data) => {
            document.getElementById('temperature').innerText =
              'Nhiệt độ: ' + data + ' °C'
          })
          .catch((error) => console.error('Error:', error))
      }

      function getHumidity() {
        fetch(espServer + '/dht/hum')
          .then((response) => {
            if (!response.ok) {
              throw new Error('Network response was not ok')
            }
            return response.text()
          })
          .then((data) => {
            document.getElementById('humidity').innerText =
              'Độ ẩm: ' + data + ' %'
          })
          .catch((error) => console.error('Error:', error))
      }
      function getLight() {
        fetch(espServer + '/light')
          .then((response) => {
            if (!response.ok) {
              throw new Error('Network response was not ok')
            }
            return response.text()
          })
          .then((data) => {
            document.getElementById('light').innerText = 'Ánh sáng: ' + data
          })
          .catch((error) => console.error('Error:', error))
      }
      function getLine() {
        fetch(espServer + '/line')
          .then((response) => {
            if (!response.ok) {
              throw new Error('Network response was not ok')
            }
            return response.text()
          })
          .then((data) => {
            document.getElementById('line').innerText = 'Dò line: ' + data
          })
          .catch((error) => console.error('Error:', error))
      }
      function getGas() {
        fetch(espServer + '/gas')
          .then((response) => {
            if (!response.ok) {
              throw new Error('Network response was not ok')
            }
            return response.text()
          })
          .then((data) => {
            document.getElementById('line').innerText = 'Dò line: ' + data
          })
          .catch((error) => console.error('Error:', error))
      }

      function updateData() {
        getLine()
      }

      function controlServo() {
        const angle = document.getElementById('servoAngle').value
        fetch(espServer + `/servo?angle=${angle * 2}`)
          .then((response) => {
            if (!response.ok) {
              throw new Error('Network response was not ok')
            }
            console.log('Servo controlled')
          })
          .catch((error) => console.error('Error:', error))
      }

      function controlDC() {
        dc = !dc
        fetch(espServer + `/dc?direction=${+dc}`)
          .then((response) => {
            if (!response.ok) {
              throw new Error('Network response was not ok')
            }
          })
          .catch((error) => console.error('Error:', error))
      }

      setInterval(updateData, 1000)
      //updateData();
    </script>
  </body>
</html>
